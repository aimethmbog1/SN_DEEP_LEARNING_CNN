"""
Configuration centralisÃ©e pour tous les notebooks et l'app Streamlit
"""
from pathlib import Path
import torch

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  CHEMINS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BASE_DIR = Path(__file__).parent
IMG_DIR = BASE_DIR / "dataset/images/images"
RESULTS_DIR = BASE_DIR / "results"
MODELS_DIR = BASE_DIR / "models"

# CrÃ©er dossiers si inexistants
RESULTS_DIR.mkdir(exist_ok=True)
MODELS_DIR.mkdir(exist_ok=True)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  CLASSES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CLASSES = sorted([
    "crease", "crescent_gap", "inclusion", "oil_spot",
    "punching_hole", "rolled_pit", "silk_spot",
    "waist_folding", "water_spot", "welding_line"
])

CLASS2IDX = {cls: idx for idx, cls in enumerate(CLASSES)}
IDX2CLASS = {idx: cls for cls, idx in CLASS2IDX.items()}
NUM_CLASSES = len(CLASSES)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  HYPERPARAMÃˆTRES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMG_SIZE = 224
BATCH_SIZE = 8
NUM_WORKERS = 4

# Statistiques calculÃ©es dans NB02
MEAN = [0.331, 0.331, 0.331]
STD = [0.096, 0.096, 0.096]

# Architecture
BACKBONE = "resnet50"  # ou "efficientnet_b0"

# Device
DEVICE = torch.device("cuda" if torch.cuda.is_available() else "cpu")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  CHEMINS FICHIERS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MODEL_PATH = MODELS_DIR / "final_model.pth"
MODEL_CONFIG_PATH = MODELS_DIR / "model_config.json"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  SEUILS & PARAMÃˆTRES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CONFIDENCE_THRESHOLD = 0.5  # Seuil pour afficher prÃ©diction
GRADCAM_ALPHA = 0.4         # Transparence overlay Grad-CAM

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  COULEURS (pour visualisations)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COLOR_PALETTE = {
    'crease': '#FF6B6B',
    'crescent_gap': '#4ECDC4',
    'inclusion': '#FFD93D',
    'oil_spot': '#6BCB77',
    'punching_hole': '#C77DFF',
    'rolled_pit': '#FF9F43',
    'silk_spot': '#48DBFB',
    'waist_folding': '#FF6B81',
    'water_spot': '#A29BFE',
    'welding_line': '#55EFC4'
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  DESCRIPTIONS DES DÃ‰FAUTS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DEFECT_DESCRIPTIONS = {
    'crease': {
        'name': 'Pli (Crease)',
        'severity': 'ModÃ©rÃ©e',
        'description': 'DÃ©formation longitudinale due Ã  un pliage lors du laminage.',
        'impact': 'Affaiblit la structure, risque de fissure.',
        'icon': 'ğŸ“'
    },
    'crescent_gap': {
        'name': 'Ã‰cart en Croissant',
        'severity': 'Faible',
        'description': 'Vide en forme de croissant sur la surface.',
        'impact': 'DÃ©faut esthÃ©tique, faible impact structurel.',
        'icon': 'ğŸŒ™'
    },
    'inclusion': {
        'name': 'Inclusion',
        'severity': 'Ã‰levÃ©e',
        'description': 'Corps Ã©tranger piÃ©gÃ© dans l\'acier (scories, oxydes).',
        'impact': 'Point de faiblesse critique, risque de rupture.',
        'icon': 'âš«'
    },
    'oil_spot': {
        'name': 'Tache d\'Huile',
        'severity': 'Faible',
        'description': 'RÃ©sidu d\'huile de laminage sur la surface.',
        'impact': 'DÃ©faut esthÃ©tique, nettoyable.',
        'icon': 'ğŸ’§'
    },
    'punching_hole': {
        'name': 'Trou de PoinÃ§onnage',
        'severity': 'Critique',
        'description': 'Perforation accidentelle lors du poinÃ§onnage.',
        'impact': 'PiÃ¨ce inutilisable, rebut.',
        'icon': 'ğŸ•³ï¸'
    },
    'rolled_pit': {
        'name': 'PiqÃ»re de Laminage',
        'severity': 'ModÃ©rÃ©e',
        'description': 'Petite cavitÃ© crÃ©Ã©e lors du laminage.',
        'impact': 'RÃ©duit la rÃ©sistance locale.',
        'icon': 'ğŸ”´'
    },
    'silk_spot': {
        'name': 'Tache Soyeuse',
        'severity': 'Faible',
        'description': 'DÃ©faut de surface brillante et lisse.',
        'impact': 'DÃ©faut esthÃ©tique mineur.',
        'icon': 'âœ¨'
    },
    'waist_folding': {
        'name': 'Pli de Taille',
        'severity': 'ModÃ©rÃ©e',
        'description': 'Pliage transversal dÃ» Ã  un rÃ©glage incorrect.',
        'impact': 'DÃ©formation permanente.',
        'icon': 'ã€°ï¸'
    },
    'water_spot': {
        'name': 'Tache d\'Eau',
        'severity': 'Faible',
        'description': 'Marque laissÃ©e par l\'eau de refroidissement.',
        'impact': 'DÃ©faut esthÃ©tique, oxydation possible.',
        'icon': 'ğŸ’¦'
    },
    'welding_line': {
        'name': 'Ligne de Soudure',
        'severity': 'ModÃ©rÃ©e',
        'description': 'Trace visible d\'une soudure.',
        'impact': 'Zone de faiblesse potentielle.',
        'icon': 'âš¡'
    }
}
